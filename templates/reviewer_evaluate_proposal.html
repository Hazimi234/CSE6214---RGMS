<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Evaluate Proposal - GrantSysMMU</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .rating-group {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        /* Question Text Styling */
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-text {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
            margin: 0;
        }

        /* The Badge showing the score in Read-Only Mode */
        .score-badge {
            background-color: #e8f5e9;
            color: #2e7d32;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
            border: 1px solid #c8e6c9;
            font-size: 0.9rem;
        }

        /* Radio Button Container */
        .rating-options {
            display: flex;
            gap: 15px;
        }

        /* Individual Radio Label */
        .rating-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            transition: all 0.2s;
        }

        /* Hover effect for active editing */
        .rating-option:hover:not(.disabled) {
            background-color: #f1f8e9;
            border-color: #a5d6a7;
        }

        /* Selected State */
        input[type="radio"]:checked+span {
            font-weight: bold;
            color: #1b5e20;
        }

        /* Read Only Mode specific adjustments */
        .disabled {
            cursor: default;
            opacity: 0.8;
            background-color: #f9f9f9;
        }

        .rating-option.selected-readonly {
            background-color: #2e7d32;
            color: white !important;
            border-color: #2e7d32;
        }

        .rating-option.selected-readonly span {
            color: white !important;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <div class="sidebar">
            <div class="sidebar-header"><i class="fas fa-tasks"
                    style="margin-right: 10px; color: var(--secondary-color);"></i> GrantSysMMU</div>
            <ul class="sidebar-menu">
                <li><a href="{{ url_for('reviewer_dashboard') }}"><i class="fas fa-home"></i>
                        Dashboard</a></li>
                <li><a href="{{ url_for('reviewer_profile') }}"><i class="fas fa-user-circle"></i> My Account</a></li>
                <li><a href="{{ url_for('reviewer_view_proposals') }}"><i class="fas fa-clipboard-list"></i> Assigned
                        Proposal</a></li>
                <li class="active"><a href="{{ url_for('reviewer_evaluation_list') }}"><i class="fas fa-history"></i>
                        Review Proposal</a></li>
                <li style="margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1);">
                    <a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </li>
            </ul>
        </div>

        <div class="main-content">
            <div class="top-bar">
                <h2>Evaluation: {{ proposal.title }}</h2>
                <div style="display: flex; align-items: center; gap: 25px;">
                    <a href="{{ url_for('view_notifications') }}"
                        style="position: relative; color: #555; font-size: 1.2rem; text-decoration: none;">
                        <i class="fas fa-bell"></i>
                        {% if unread_notifications > 0 %}
                        <span
                            style="position: absolute; top: -8px; right: -8px; background: #c62828; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                            {{ unread_notifications }}
                        </span>
                        {% endif %}
                    </a>

                    <div style="width: 1px; height: 30px; background: #ddd;"></div>

                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="text-align: right; line-height: 1.3;">
                            <span style="display: block; font-weight: bold; color: #1b5e20;">{{ user.name }}</span>
                            <small style="color: #666;">Reviewer</small>
                        </div>
                        <a href="{{ url_for('reviewer_dashboard') }}">
                            <img src="{{ url_for('static', filename='profile_pics/' + user.profile_image) }}"
                                alt="Profile"
                                style="width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid #4caf50; padding: 2px;">
                        </a>
                    </div>
                </div>
            </div>

            <div class="content-wrapper">

                <a href="{{ url_for('reviewer_evaluation_list') }}"
                    style="display: inline-flex; align-items: center; margin-bottom: 20px; color: #666; text-decoration: none; font-weight: bold;">
                    <i class="fas fa-arrow-left" style="margin-right: 5px;"></i> Back to Evaluation Queue
                </a>

                {% if readonly %}
                <div class="alert alert-info"
                    style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; background-color: #e3f2fd; color: #0d47a1; border: 1px solid #bbdefb;">
                    <i class="fas fa-lock" style="font-size: 1.2rem;"></i>
                    <div>
                        <strong>Read-Only Mode</strong><br>
                        You submitted this evaluation on {{ proposal.submission_date.strftime('%d %b %Y') }}. Final
                        Score: <strong>{{ proposal.review_score }}/100</strong>.
                    </div>
                </div>
                {% endif %}

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">

                    <div class="section-card"
                        style="height: 1200px; padding: 0; overflow: hidden; display: flex; flex-direction: column; position: sticky; top: 20px;">
                        <div style="padding: 15px; background: #f9f9f9; border-bottom: 1px solid #ddd;">
                            <h4 style="margin: 0; color: #333;"><i class="fas fa-file-pdf" style="color: #d32f2f;"></i>
                                Reference Document</h4>
                        </div>
                        <div style="flex: 1;">
                            {% if proposal.document_file %}
                            <embed src="{{ url_for('static', filename='proposal_docs/' + proposal.document_file) }}"
                                type="application/pdf" width="100%" height="100%" />
                            {% else %}
                            <p style="padding: 20px; text-align: center; color: #666;">No document available.</p>
                            {% endif %}
                        </div>
                    </div>

                    <div class="section-card">
                        <h3
                            style="color: #1b5e20; border-bottom: 2px solid #e8f5e9; padding-bottom: 10px; margin-bottom: 20px;">
                            <i class="fas fa-clipboard-check"></i> Scoring Worksheet
                        </h3>

                        <form method="POST">

                            <h4
                                style="color: #1565c0; margin-top: 20px; background: #e3f2fd; padding: 10px; border-radius: 5px;">
                                1. Goals & Objectives</h4>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">1. Are the proposed activities likely to achieve the
                                        stated goals?</label>
                                    {% if readonly and saved_answers.get('q1') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q1') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q1') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q1" value="{{ i }}" {% if
                                            saved_answers.get('q1')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">2. Does the proposal clearly describe and justify
                                        ongoing activities?</label>
                                    {% if readonly and saved_answers.get('q2') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q2') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q2') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q2" value="{{ i }}" {% if
                                            saved_answers.get('q2')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">3. Does it offer insights into structure, staffing, and
                                        management?</label>
                                    {% if readonly and saved_answers.get('q3') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q3') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q3') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q3" value="{{ i }}" {% if
                                            saved_answers.get('q3')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">4. Is the evidence of need compelling?</label>
                                    {% if readonly and saved_answers.get('q4') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q4') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q4') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q4" value="{{ i }}" {% if
                                            saved_answers.get('q4')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">5. Are the potential benefits clear and
                                        significant?</label>
                                    {% if readonly and saved_answers.get('q5') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q5') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q5') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q5" value="{{ i }}" {% if
                                            saved_answers.get('q5')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <h4
                                style="color: #1565c0; margin-top: 20px; background: #e3f2fd; padding: 10px; border-radius: 5px;">
                                2. Feasibility & Timeline</h4>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">6. Is the project timeline realistic?</label>
                                    {% if readonly and saved_answers.get('q6') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q6') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q6') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q6" value="{{ i }}" {% if
                                            saved_answers.get('q6')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">7. Is the organization capable of meeting
                                        deadlines?</label>
                                    {% if readonly and saved_answers.get('q7') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q7') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q7') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q7" value="{{ i }}" {% if
                                            saved_answers.get('q7')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">8. Are the target participants appropriate?</label>
                                    {% if readonly and saved_answers.get('q8') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q8') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q8') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q8" value="{{ i }}" {% if
                                            saved_answers.get('q8')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">9. Are the service providers capable?</label>
                                    {% if readonly and saved_answers.get('q9') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q9') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q9') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q9" value="{{ i }}" {% if
                                            saved_answers.get('q9')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">10. Are the project overseers qualified?</label>
                                    {% if readonly and saved_answers.get('q10') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q10') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q10') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q10" value="{{ i }}" {% if
                                            saved_answers.get('q10')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <h4
                                style="color: #1565c0; margin-top: 20px; background: #e3f2fd; padding: 10px; border-radius: 5px;">
                                3. Strategy & Success</h4>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">11. Is the project approach practical?</label>
                                    {% if readonly and saved_answers.get('q11') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q11') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q11') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q11" value="{{ i }}" {% if
                                            saved_answers.get('q11')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">12. Does it demonstrate understanding of best
                                        practices?</label>
                                    {% if readonly and saved_answers.get('q12') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q12') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q12') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q12" value="{{ i }}" {% if
                                            saved_answers.get('q12')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">13. Are success metrics clearly defined?</label>
                                    {% if readonly and saved_answers.get('q13') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q13') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q13') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q13" value="{{ i }}" {% if
                                            saved_answers.get('q13')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">14. Is the location selection justified?</label>
                                    {% if readonly and saved_answers.get('q14') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q14') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q14') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q14" value="{{ i }}" {% if
                                            saved_answers.get('q14')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">15. Is collaboration with other organizations
                                        considered?</label>
                                    {% if readonly and saved_answers.get('q15') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q15') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q15') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q15" value="{{ i }}" {% if
                                            saved_answers.get('q15')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <h4
                                style="color: #1565c0; margin-top: 20px; background: #e3f2fd; padding: 10px; border-radius: 5px;">
                                4. Budget & Resources</h4>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">16. Is the budget adequate to carry out the
                                        program?</label>
                                    {% if readonly and saved_answers.get('q16') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q16') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q16') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q16" value="{{ i }}" {% if
                                            saved_answers.get('q16')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">17. Is the budget free of padding/unrelated
                                        expenses?</label>
                                    {% if readonly and saved_answers.get('q17') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q17') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q17') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q17" value="{{ i }}" {% if
                                            saved_answers.get('q17')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">18. Is there support from unrestricted
                                        resources?</label>
                                    {% if readonly and saved_answers.get('q18') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q18') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q18') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q18" value="{{ i }}" {% if
                                            saved_answers.get('q18')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">19. Is there support from other funders?</label>
                                    {% if readonly and saved_answers.get('q19') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q19') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q19') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q19" value="{{ i }}" {% if
                                            saved_answers.get('q19')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="rating-group">
                                <div class="question-header">
                                    <label class="question-text">20. Is the sustainability plan clear?</label>
                                    {% if readonly and saved_answers.get('q20') %}
                                    <span class="score-badge">Selected: {{ saved_answers.get('q20') }}</span>
                                    {% endif %}
                                </div>
                                <div class="rating-options">
                                    {% for i in range(1, 6) %}
                                    <label
                                        class="rating-option {% if readonly %}disabled{% endif %} {% if saved_answers.get('q20') == i|string %}selected-readonly{% endif %}">
                                        <input type="radio" name="q20" value="{{ i }}" {% if
                                            saved_answers.get('q20')==i|string %}checked{% endif %} {% if readonly
                                            %}disabled{% endif %}>
                                        <span>{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <div style="margin-top: 30px;">
                                <label style="font-weight: bold; font-size: 1.1rem; color: #1b5e20;">Reviewer
                                    Feedback</label>
                                <textarea name="feedback" rows="5"
                                    style="width: 100%; padding: 15px; border: 1px solid #ccc; border-radius: 5px; margin-top: 8px; font-family: inherit; font-size: 1rem; background-color: {% if readonly %}#fff9c4{% else %}white{% endif %}; color: #333;"
                                    {% if readonly %}disabled{% endif
                                    %}>{{ saved_answers.get('feedback', '') }}</textarea>
                            </div>

                            {% if not readonly %}
                            <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-top: 20px;">
                                <p style="margin: 0; font-size: 0.9rem; color: #2e7d32;">
                                    <strong>Note:</strong> <br>
                                    • <strong>Save Draft:</strong> Saves your current progress. You can come back
                                    later.<br>
                                    • <strong>Submit:</strong> Finalizes the score. Cannot be edited afterwards.
                                </p>
                            </div>

                            <div style="margin-top: 20px; display: flex; gap: 15px;">
                                <button type="submit" name="action" value="save_draft" class="btn-outline"
                                    style="flex: 1;">
                                    <i class="fas fa-save"></i> Save Draft
                                </button>
                                <button type="submit" name="action" value="submit" class="btn-primary" style="flex: 1;"
                                    onclick="return confirm('Are you sure you want to submit? This cannot be undone.');">
                                    <i class="fas fa-paper-plane"></i> Submit Final
                                </button>
                            </div>
                            {% endif %}

                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>
</body>

</html>